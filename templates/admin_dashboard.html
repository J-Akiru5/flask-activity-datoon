{% extends "base_admin.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div style="margin-bottom: 30px;">
        <h1 class="page-title">Welcome, {{ session.admin_username }}</h1>
        <p class="page-subtitle">Manage student records efficiently from this dashboard.</p>
    </div>

    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('admin_add_student') }}">
            <button class="btn add-student-btn">
                <i class="fas fa-plus"></i> Add Student Record
            </button>
        </a>
    </div>

    <div class="card">
        <h2 style="margin-bottom: 20px;">Student Records</h2>
        
        <div class="table-container">
            <table class="student-table">
                <thead>
                    <tr>
                        <th>Photo</th>
                        <th>ID Number</th>
                        <th>First Name</th>
                        <th>Middle Name</th>
                        <th>Last Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for s in students %}
                    <tr>
                        <td>
                            {% if s.photo %}
                                <img src="{{ url_for('static', filename='uploads/students/' ~ s.photo) }}" class="student-photo">
                            {% else %}
                                <div class="student-photo-placeholder"><i class="fas fa-user"></i></div>
                            {% endif %}
                        </td>
                        <td>{{ s.id_number }}</td>
                        <td>{{ s.first_name }}</td>
                        <td>{{ s.middle_name }}</td>
                        <td>{{ s.last_name }}</td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 6px 14px; font-size: 14px; margin-right: 5px;" 
                                onclick="openEditModal('{{ s.id_number }}','{{ s.first_name }}','{{ s.middle_name }}','{{ s.last_name }}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn logout-btn" style="padding: 6px 14px; font-size: 14px;" 
                                onclick="openDeleteModal('{{ s.id_number }}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                {% endfor %}
                {% if not students %}
                    <tr>
                        <td colspan="6" class="no-records">No students registered yet.</td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- EDIT MODAL -->
<div id="editModal" class="modal">
  <div class="modal-content card">
    <span onclick="closeEditModal()" class="close">&times;</span>
    <h3 style="margin-bottom: 20px; color: #667eea;">Edit Student</h3>

    <form id="editForm" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label>First Name</label>
            <input type="text" name="first_name" id="edit_first" required>
        </div>
        <div class="form-group">
            <label>Middle Name</label>
            <input type="text" name="middle_name" id="edit_middle">
        </div>
        <div class="form-group">
            <label>Last Name</label>
            <input type="text" name="last_name" id="edit_last" required>
        </div>
        <div class="form-group">
            <label>Change Photo (Optional)</label>
            <input type="file" name="photo" accept="image/*">
        </div>
        <div style="margin-top: 20px;">
            <button type="submit" class="btn" style="width: 100%;">Save Changes</button>
        </div>
    </form>
  </div>
</div>

<!-- DELETE MODAL -->
<div id="deleteModal" class="modal">
  <div class="modal-content card" style="text-align: center;">
    <span onclick="closeDeleteModal()" class="close">&times;</span>
    <h3 style="margin-bottom: 15px; color: #dc3545;">Confirm Delete</h3>
    <p style="margin-bottom: 25px;">Are you sure you want to delete this student? This action cannot be undone.</p>

    <form id="deleteForm" method="POST">
        <div style="display: flex; gap: 10px;">
            <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeDeleteModal()">Cancel</button>
            <button type="submit" class="btn logout-btn" style="flex: 1;">Yes, Delete</button>
        </div>
    </form>
  </div>
</div>

<script>
function openEditModal(id, first, middle, last) {
    document.getElementById("edit_first").value = first;
    document.getElementById("edit_middle").value = middle;
    document.getElementById("edit_last").value = last;
    document.getElementById("editForm").action = "/admin-edit-student/" + id;
    document.getElementById("editModal").style.display = "block";
}

function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
}

function openDeleteModal(id) {
    document.getElementById("deleteForm").action = "/admin-delete-student/" + id;
    document.getElementById("deleteModal").style.display = "block";
}

function closeDeleteModal() {
    document.getElementById("deleteModal").style.display = "none";
}

// Close modal when clicking outside
window.onclick = function(event) {
    var editModal = document.getElementById('editModal');
    var deleteModal = document.getElementById('deleteModal');
    if (event.target == editModal) {
        editModal.style.display = "none";
    }
    if (event.target == deleteModal) {
        deleteModal.style.display = "none";
    }
}
</script>
{% endblock %}
